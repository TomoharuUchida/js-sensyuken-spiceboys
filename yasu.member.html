<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Member List</title>

  <link rel="stylesheet" href="./css/reset.css">
  <link rel="stylesheet" href="./css/yasu.style.css">
</head>
<body>
  <!-- memberlistセクション -->
  <div class="wrapper_y">
    
    <section id="member_list_y">
      
      <div id="member_contents_y">
        <h2>our house member</h2>
        
        <div id="member_view_y"></div>
        
      </div>
      
    </section>
  </div>

  <!-- jquery読み込み -->
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>

  <script type="module">
    //firebereを利用するためのコード
    import { initializeApp } from "https://www.gstatic.com/firebasejs/9.4.1/firebase-app.js";

    //authenticaonを利用するためのコード
    import { 
      getAuth, 
      createUserWithEmailAndPassword,
      signInWithEmailAndPassword,
      signOut,
      onAuthStateChanged,
      updateProfile,
      } from "https://www.gstatic.com/firebasejs/9.4.1/firebase-auth.js";

    //cloudfirestoreを利用するためのコード
    import { 
      getFirestore,
      collection, 
      addDoc,
      serverTimestamp,
      onSnapshot,
      query,
      orderBy,
      getDoc,
      deleteDoc,
      doc,
      } from "https://www.gstatic.com/firebasejs/9.4.1/firebase-firestore.js";

      //storegeを使うためのコード  
    import {
      getStorage,
      ref,
      uploadBytes,
      getDownloadURL,
    } from "https://www.gstatic.com/firebasejs/9.4.1/firebase-storage.js";

    // firebeceのプロダクトを指定するコード APYkey
    const firebaseConfig = {
      
      };


    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    // Initialize authenticaon
    const auth = getAuth(app);
    // Initialize firestore
    const db = getFirestore(app);
    // initialize storage
    const storage = getStorage(app);

    
    onSnapshot(collection(db, "user"), (querySnapshot) => {
      console.log(querySnapshot.docs);
      const dataArray = [];//オブジェクトに変えるようの配列
      const userArray = [];//ユーザー情報のみを取得する用の配列
      const imgArray = [];//画像表示用の配列

      querySnapshot.docs.forEach(function (doc) { //querySnapshot.docsをわかりやすいように
        const data = {
          id: doc.id,
          data: doc.data(),
        };
        dataArray.push(data);
      });
      
      dataArray.forEach(function(doc){ //dataArrayを分解
        const udata = {
          id:doc.id,
          uid:doc.data.uid,
          name:doc.data.name,
          img:doc.data.img,
          hobby:doc.data.hobby,
          birthday:doc.data.birthday,
          food:doc.data.food,
        }
        userArray.push(udata);
      })      
      console.log(userArray); //userのオブジェクトが完成!!!!

      for(let i = 0; i < userArray.length; i++) { //userArrayにタグ付けをするための繰り返し処理
        
        imgArray.push(`
        
        <div id="${userArray[i].id}">
          <div class="member_face_y">
            <img src ="${userArray[i].img}" class="member_img_y">
            <h3 class="">${userArray[i].name}</h3>
          </div>

          <div id="info_${userArray[i].id}" class="member_info_y">

              <div id="info_block_y">
                <div>hobby:${userArray[i].hobby}</div>
                <div>birthday:${userArray[i].birthday}</div>
                <div>favoritefood:${userArray[i].food}</div>
              </div>

          <div>
        </div>
        `);
      }

      $('#member_view_y').html(imgArray);
      $('.member_info_y').hide();

      $('.member_face_y').on('click',function(){
        console.log('click');
        let id = $(this).parent().attr('id');
        console.log(id);
        $(`#info_${id}`).slideDown();

        $(`#info_${id}`).on('click',function(){
          $(`#info_${id}`).slideUp();
        })
      });






    }); //onSnapshotここまで

    


  </script>
  
  
  
</body>
</html>